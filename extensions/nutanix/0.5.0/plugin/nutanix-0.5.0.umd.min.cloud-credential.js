(("undefined"!==typeof self?self:this)["webpackJsonpnutanix_0_5_0"]=("undefined"!==typeof self?self:this)["webpackJsonpnutanix_0_5_0"]||[]).push([[1],{"1a09":function(e,t,a){var s=a("ba2c");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("a0716a28",s,!0,{sourceMap:!1,shadowMode:!1})},"35ab":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"row"},[t("div",{staticClass:"col span-6"},[t("LabeledInput",{attrs:{value:e.value.decodedData.endpoint,disabled:1!==e.step,"label-key":"driver.nutanix.auth.fields.endpoint","placeholder-key":"driver.nutanix.auth.placeholders.endpoint",type:"text",mode:e.mode},on:{input:function(t){return e.value.setData("endpoint",t)}}})],1),t("div",{staticClass:"col span-6"},[t("LabeledInput",{attrs:{value:e.value.decodedData.port,disabled:1!==e.step,"label-key":"driver.nutanix.auth.fields.port","placeholder-key":"driver.nutanix.auth.placeholders.port",type:"text",mode:e.mode},on:{input:function(t){return e.value.setData("port",t)}}})],1)]),t("div",{staticClass:"row"},[t("div",{staticClass:"col span-6"},[t("LabeledInput",{staticClass:"mt-20",attrs:{value:e.value.decodedData.username,disabled:1!==e.step,"label-key":"driver.nutanix.auth.fields.username","placeholder-key":"driver.nutanix.auth.placeholders.username",type:"text",mode:e.mode},on:{input:function(t){return e.value.setData("username",t)}}})],1),t("div",{staticClass:"col span-6"},[t("LabeledInput",{staticClass:"mt-20",attrs:{value:e.value.decodedData.password,disabled:1!==e.step,"label-key":"driver.nutanix.auth.fields.password","placeholder-key":"driver.nutanix.auth.placeholders.password",type:"password",mode:e.mode},on:{input:function(t){return e.value.setData("password",t)}}})],1)]),t("div",{staticClass:"row"},[t("div",{staticClass:"col span-6"},[t("Checkbox",{staticClass:"mt-20",attrs:{value:e.value.decodedData.insecure,valueWhenTrue:!0,"label-key":"driver.nutanix.auth.fields.insecure",disabled:!0},on:{input:function(t){return e.value.setData("insecure",t)}}})],1)]),t("button",{ref:"connect",staticClass:"btn role-primary mt-20",attrs:{disabled:1!==e.step||!e.canAuthenticate,loading:1!==e.step||!e.canAuthenticate},on:{click:function(t){return e.connect(t)}}},[e.busy?t("i",{staticClass:"icon icon-lg icon-spinner icon-spin"}):t("span",{staticClass:"icon-spacer"}),t("span",[e._v(e._s(e.t("driver.nutanix.auth.actions.authenticate")))]),t("span",{staticClass:"icon-spacer"})]),e.success?t("Banner",{attrs:{color:"success",closable:!1}},[e._v(" "+e._s(e.success)+" ")]):e._e(),e.error?t("Banner",{staticClass:"mt-20",attrs:{color:"error"}},[e._v(" "+e._s(e.error)+" ")]):e._e(),e.errorAllowHost?t("Banner",{staticClass:"allow-list-error",attrs:{color:"error"}},[t("div",[e._v(" "+e._s(e.t("driver.nutanix.auth.errors.notAllowed",{hostname:e.hostname}))+" ")]),t("button",{staticClass:"btn ml-10 role-primary",attrs:{disabled:e.allowBusy},on:{click:e.addHostToAllowList}},[e._v(" "+e._s(e.t("driver.nutanix.auth.actions.addToAllowList"))+" ")])]):e._e()],1)},i=[];function o(e){const t=o.options,a=t.parser[t.strictMode?"strict":"loose"].exec(e);if(!a)throw new Error("Cannot parse as uri: "+e);const s={};let i=14;while(i--)s[t.key[i]]=a[i]||"";return s.query={},s.queryStr.replace(t.q.parser,(e,a,i)=>(a&&(s[t.q.name][a]=i),"")),s}o.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","queryStr","anchor"],q:{name:"query",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};a("da25");var r=a("78a1"),n=a("eb32"),l=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{class:{"labeled-input":!0,focused:e.focused,[e.mode]:!0,disabled:e.isDisabled,[e.status]:e.status,suffix:e.hasSuffix,"has-tooltip":e.hasTooltip,"compact-input":e.isCompact,hideArrows:e.hideArrows}},[e._t("label",(function(){return[e.hasLabel?t("label",[e.labelKey?t("t",{attrs:{k:e.labelKey}}):e.label?[e._v(e._s(e.label))]:e._e(),e.requiredField?t("span",{staticClass:"required"},[e._v("*")]):e._e()],2):e._e()]})),e._t("prefix"),e._t("field",(function(){return["multiline"===e.type||"multiline-password"===e.type?t("TextAreaAutoGrow",e._b({ref:"value",class:{conceal:"multiline-password"===e.type},attrs:{maxlength:e._maxlength,disabled:e.isDisabled,value:e.value,placeholder:e._placeholder,autocapitalize:"off"},on:{input:function(t){return e.onInput(t)},focus:e.onFocus,blur:e.onBlur}},"TextAreaAutoGrow",e.$attrs,!1)):t("input",e._b({ref:"value",class:{"no-label":!e.hasLabel},attrs:{maxlength:e._maxlength,disabled:e.isDisabled,type:"cron"===e.type?"text":e.type,placeholder:e._placeholder,autocomplete:"off",autocapitalize:"off","data-lpignore":e.ignorePasswordManagers},domProps:{value:e.value},on:{input:function(t){return e.onInput(t.target.value)},focus:e.onFocus,blur:e.onBlur}},"input",e.$attrs,!1))]})),e._t("suffix"),e.hasTooltip&&!e.focused?t("LabeledTooltip",{attrs:{hover:e.hoverTooltip,value:e.tooltipValue,status:e.status}}):e._e(),e.validationMessage?t("LabeledTooltip",{attrs:{hover:e.hoverTooltip,value:e.validationMessage}}):e._e(),e.cronHint?t("label",{staticClass:"cron-label"},[e._v(e._s(e.cronHint))]):e._e(),e.subLabel?t("label",{staticClass:"sub-label"},[e._v(e._s(e.subLabel))]):e._e()],2)},u=[],d=a("8bbf"),c=a.n(d),p=a("df7c"),h=a("480e"),v=a("c230"),f=a("e1bc"),b=a("2cb5"),m=a("2105"),y=a.n(m),w=a("1a5f"),g=a("9ec3"),x=c.a.extend({components:{LabeledTooltip:f["a"],TextAreaAutoGrow:v["a"]},mixins:[h["a"],p["a"]],props:{type:{type:String,default:"text"},status:{type:String,default:null},subLabel:{type:String,default:null},tooltip:{default:null,type:[String,Object]},hoverTooltip:{type:Boolean,default:!0},ignorePasswordManagers:{default:!1,type:Boolean},maxlength:{type:Number,default:null},hideArrows:{type:Boolean,default:!1},delay:{type:Number,default:0}},data(){return{updated:!1,validationErrors:""}},computed:{onInput(){return this.delay?Object(g["debounce"])(this.delayInput,this.delay):this.delayInput},hasLabel(){return!this.isCompact&&(!!this.label||!!this.labelKey||!!this.$slots.label)},hasTooltip(){return!!this.tooltip||!!this.tooltipKey},tooltipValue(){if(this.hasTooltip)return this.tooltipKey?this.t(this.tooltipKey):this.tooltip},hasSuffix(){return!!this.$slots.suffix},cronHint(){if("cron"===this.type&&this.value){if(!Object(w["isValidCron"])(this.value))return this.t("generic.invalidCron");try{const e=y.a.toString(this.value);return e}catch(e){return this.t("generic.invalidCron")}}},_placeholder(){return this.placeholder?this.placeholder.toString():this.placeholderKey?this.t(this.placeholderKey):""},_maxlength(){return"text"===this.type&&this.maxlength?this.maxlength:null}},methods:{focus(){const e=this.$refs.value;e&&e.focus()},select(){const e=this.$refs.value;e&&e.select()},delayInput(e){this.$emit("input",e)},onFocus(){this.onFocusLabeled()},onBlur(e){this.$emit("blur",e),this.onBlurLabeled()},escapeHtml:b["b"]}}),_=x,C=(a("5380"),a("b0d2"),a("d802")),$=Object(C["a"])(_,l,u,!1,null,"25609830",null),A=$.exports,D=a("466b"),k=a("1032"),L={components:{Banner:n["a"],LabeledInput:A,LabeledSelect:D["a"],Checkbox:k["a"]},props:{mode:{type:String,required:!0},value:{type:Object,required:!0}},async fetch(){this.driver=await this.$store.dispatch("rancher/find",{type:"nodedriver",id:"nutanix"})},data(){return{step:1,busy:!1,errorAllowHost:!1,allowBusy:!1,driver:{},error:"",success:""}},computed:{hostname(){const e=o(this.value.decodedData.endpoint);return(null===e||void 0===e?void 0:e.host)||""},canAuthenticate(){var e,t,a;return!(null===(e=this.value)||void 0===e||null===(e=e.decodedData)||void 0===e||!e.endpoint)&&!(null===(t=this.value)||void 0===t||null===(t=t.decodedData)||void 0===t||!t.username)&&!(null===(a=this.value)||void 0===a||null===(a=a.decodedData)||void 0===a||!a.password)}},methods:{test(){return!0},hostInAllowList(){var e,t;if(null===(e=this.driver)||void 0===e||!e.whitelistDomains)return!1;const a=o(this.value.decodedData.endpoint);return!a.host||((null===(t=this.driver)||void 0===t?void 0:t.whitelistDomains)||[]).includes(a.host)},async addHostToAllowList(){this.$set(this,"allowBusy",!0);const e=o(this.value.decodedData.endpoint);this.driver.whitelistDomains=this.driver.whitelistDomains||[],this.hostInAllowList()||this.driver.whitelistDomains.push(e.host);try{await this.driver.save(),this.$set(this,"error",""),this.connect()}catch(t){console.error("Could not update driver",t),this.$set(this,"allowBusy",!1)}},async connect(){if(this.disabled)return;this.$set(this,"error",""),this.$set(this,"success",""),this.$set(this,"errorAllowHost",!1);let e=!1;if(!this.value.decodedData.endpoint)return void this.$set(this,"busy",!1);this.value.decodedData.port||this.value.setData("port",9440);const t=new r["a"](this.$store,{endpoint:this.value.decodedData.endpoint,username:this.value.decodedData.username,password:this.value.decodedData.password,port:this.value.decodedData.port,insecure:this.value.decodedData.insecure});this.$set(this,"allowBusy",!1),this.$set(this,"busy",!0);const a=await t.testConnection();console.log(a),a.error?(console.error(a.error),e=!1,502!==a.error._status||this.hostInAllowList()?401===a.error._status?this.$set(this,"error","Authentification Failed"):this.$set(this,"error",a.error.message?a.error.message:"Something Went wrong"):this.$set(this,"errorAllowHost",!0)):(e=!0,this.$set(this,"success",`Welcome ${this.value.decodedData.username}, connected to ${this.value.decodedData.endpoint}`)),this.$set(this,"busy",!1),this.$emit("validationChanged",e)}}},T=L,I=(a("a28a"),Object(C["a"])(T,s,i,!1,null,"2482df9e",null));t["default"]=I.exports},5380:function(e,t,a){"use strict";a("1a09")},"5fe5":function(e,t,a){var s=a("6df2");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("716741b0",s,!0,{sourceMap:!1,shadowMode:!1})},"6c9c":function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".allow-list-error[data-v-2482df9e]{display:flex}.allow-list-error[data-v-2482df9e]>:first-child{flex:1}.icon-spacer[data-v-2482df9e]{width:24px}",""]),e.exports=t},"6df2":function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".validation-message{padding:5px;position:absolute;bottom:-35px}",""]),e.exports=t},"78a1":function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var s=a("9ec3");class i{constructor(e,t){this.endpoint="",this.username="",this.password="",this.port="",this.insecure=!1,this.clusterReferenceId="",this.credentialID="",t.nutanixcredentialConfig?(Object.keys(t.nutanixcredentialConfig).forEach(e=>{this[e]=t.nutanixcredentialConfig[e]}),this.credentialID=t.id):Object.keys(t).forEach(e=>{this[e]=t[e]}),this.$dispatch=e.dispatch}async testConnection(){const e=`/meta/proxy/${this.endpoint}:${this.port}`,t=e+"/api/clustermgmt/v4.0.b1/config/clusters",a={Accept:"application/json","X-API-Auth-Header":"Basic "+btoa(this.username+":"+this.password)};try{const e=await this.$dispatch("management/request",{url:t,headers:a,method:"GET",redirectUnauthorized:!1},{root:!0});return 502===e._status?{error:"Could not proxy request - URL may not be in Rancher's allow list"}:e}catch(s){return console.error(s),{error:s}}}async getClusterList(e,t){return await this.getOptions(e,"/api/clustermgmt/v4.0.b1/config/clusters","data",void 0,e=>e.config.hypervisorTypes.includes("AHV"),t)}async getImages(e,t){return await this.getOptions(e,"/api/vmm/v4.0.a1/images","data",void 0,void 0,t)}async getNetwork(e,t){return await this.getOptions(e,"/api/networking/v4.0.b1/config/subnets","data",async e=>{const t="OVERLAY"===e.subnetType?(await this.getVpc(e.vpcReference)).data:void 0;return{...e,baseName:e.name,name:"OVERLAY"===e.subnetType?`${e.name} (${t.name})`:e.name}},e=>"OVERLAY"==e.subnetType||e.clusterReference==this.clusterReferenceId&&!e.isExternal,t)}async getVpc(e){return await this.makeComputeRequest("/api/networking/v4.0.b1/config/vpcs/"+e)}async getStorageContainer(e,t){return await this.getOptions(e,"/api/storage/v4.0.a3/config/storage-containers","data",void 0,e=>e.clusterExtId==this.clusterReferenceId,t)}async getCategories(e,t){return await this.getOptions(e,"/api/prism/v4.0.a2/config/categories","data",e=>({...e,name:`${e.key}=${e.value}`}),e=>"Project"!==e.key,t)}async getProjectsName(e,t){return await this.getOptions(e,"/api/nutanix/v3/projects/list","entities",e=>({...e,name:""+e.spec.name}),void 0,t)}async getOptions(e,t,a,i,o,r){let n;if(e.busy=!0,e.enabled=!0,e.selected=Object(s["isArray"])(e.selected)?[]:"","/api/nutanix/v3/projects/list"===t?(console.log("getOptions: api: /api/nutanix/v3/projects/list"),n=await this.makeComputeRequest(t,"POST")):n=await this.makeComputeRequest(t),n&&n[a]){let t=n[a]||[];if(o&&(t=t.filter(e=>o(e))),i&&(t=await Promise.all(t.map(async e=>await i(e)))),e.options.forEach(e=>{t.push(e)}),e.options=this.convertToOptions(t),e.busy=!1,e.options.length<t.length){const a=t.filter((e,a)=>a!==t.findIndex(t=>e.name===t.name));e.duplicates=a}if(r){const t=e.options.find(e=>e.value.name===r);t&&(e.selected=t.value)}}else e.options=[],e.selected=Object(s["isArray"])(e.selected)?[]:null,e.busy=!1,e.enabled=!1}async makeComputeRequest(e,t="GET"){const a=`/meta/proxy/${this.endpoint}:${this.port}`,s=`${a}${e}`,i={Accept:"application/json","Content-Type":"application/json","X-API-Auth-Header":"Basic "+btoa(this.username+":"+this.password)};try{const e=await this.$dispatch("management/request",{url:s,headers:i,method:t,data:JSON.stringify({}),redirectUnauthorized:!1},{root:!0});return e}catch(o){console.error(o)}}convertToOptions(e){const t=e.filter((t,a)=>a===e.findIndex(e=>t.name===e.name)),a=(t||[]).sort((e,t)=>e.name.localeCompare(t.name));return a.map(e=>({label:e.name,value:e}))}}},a28a:function(e,t,a){"use strict";a("ef28")},b0d2:function(e,t,a){"use strict";a("5fe5")},ba2c:function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".labeled-input.view input[data-v-25609830]{text-overflow:ellipsis}.hideArrows input[data-v-25609830]::-webkit-inner-spin-button,.hideArrows input[data-v-25609830]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.hideArrows input[type=number][data-v-25609830]{-moz-appearance:textfield}",""]),e.exports=t},ef28:function(e,t,a){var s=a("6c9c");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("cc8b9f0a",s,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=nutanix-0.5.0.umd.min.cloud-credential.js.map